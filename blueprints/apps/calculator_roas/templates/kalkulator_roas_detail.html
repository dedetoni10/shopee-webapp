{% extends 'base_auth.html' %}

{% block title %}Detail: {{ app.name }} | rumaiku.id{% endblock %}
{% block header_title %}Detail Aplikasi: {{ app.name }}{% endblock %}

{% block app_notification %}
    {# Notifikasi aplikasi sekarang berada di sini, berdasarkan data yang diteruskan dari blueprint #}
    {% if notification_type == 'trial' or notification_type == 'expired' or notification_type == 'premium' %}
        <div class="w-full py-2 px-4 text-center text-sm font-medium sticky top-0 z-20
            {% if notification_type == 'trial' or notification_type == 'expired' %} bg-red-500 text-white shadow-sm
            {% elif notification_type == 'premium' %} bg-green-500 text-white shadow-sm
            {% endif %}">
            <div class="flex items-center justify-center">
                <span id="app-notification-message" class="flex-grow">
                    {# Text will be set by JavaScript #}
                </span>
                <a href="https://wa.me/{{ whatsapp_number }}" target="_blank" class="ml-4 px-3 py-1 text-xs rounded-md bg-white bg-opacity-20 hover:bg-opacity-30 transition-colors duration-200">
                    Hubungi Admin
                </a>
            </div>
        </div>
    {% endif %}
{% endblock %}


{% block content %}
<div class="container mx-auto mt-6 p-4 md:p-6 bg-white rounded-lg shadow-xl">
    <div class="flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6">
        <div class="p-4 bg-blue-100 rounded-lg flex-shrink-0">
            {% if app.url == 'roas_calculator' %}
            <svg class="w-16 h-16 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v4m0-4H9m0 0V9m6 0a6 6 0 01-6 6H9a6 6 0 01-6-6V9a6 6 0 016-6h6a6 6 0 016 6v4a6 6 0 01-6 6h-3"></path></svg>
            {% else %}
            <svg class="w-16 h-16 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
            {% endif %}
        </div>
        <div class="flex-grow text-center md:text-left">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">{{ app.name }}</h1>
            <p class="text-gray-700 text-lg mb-4">{{ app.description }}</p>

            {% if is_installed %}
                {% if trial_expired and not is_premium_active %}
                    <p class="text-red-600 font-semibold mb-2">Akses aplikasi telah berakhir. Harap perbarui langganan Anda.</p>
                    <a href="https://wa.me/{{ whatsapp_number }}?text=Halo%20Admin%2C%20saya%20ingin%20memperpanjang%20akses%20aplikasi%20{{ app.name | urlencode }}" target="_blank" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-200">
                        Perpanjang Akses
                    </a>
                {% elif is_premium_active %}
                    <p class="text-green-600 font-semibold mb-2">Anda memiliki akses Premium ke aplikasi ini.</p>
                    <a href="{{ url_for('calculator_roas.index') }}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-200">
                        Buka Aplikasi
                    </a>
                {% else %} {# Trial aktif #}
                    <p class="text-green-600 font-semibold mb-2">Aplikasi ini sudah terinstal dan dalam masa percobaan.</p>
                    <a href="{{ url_for('calculator_roas.index') }}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-200">
                        Buka Aplikasi
                    </a>
                {% endif %}
            {% else %}
                <p class="text-gray-600 mb-4">Instal aplikasi ini untuk memulai masa percobaan gratis selama 24 jam.</p>
                <form action="{{ url_for('calculator_roas.activate_trial', app_id=app.id) }}" method="POST"> {# Mengarah ke activate_trial #}
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-200">
                        Mulai Masa Percobaan
                    </button>
                </form>
            {% endif %}
        </div>
    </div>

    <div class="mt-8 border-t border-gray-200 pt-6">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Tentang Aplikasi Ini</h3>
        <p class="text-gray-600 leading-relaxed">
            {# Contoh detail lebih lanjut tentang aplikasi ini #}
            Kalkulator ROAS adalah alat esensial bagi para pengiklan online untuk mengukur efektivitas kampanye iklan mereka. Dengan memasukkan data biaya iklan dan omzet penjualan yang dihasilkan dari iklan, Anda dapat dengan cepat mengetahui Return on Ad Spend (ROAS) Anda. Aplikasi ini juga menyediakan rekomendasi untuk optimasi, membantu Anda memaksimalkan keuntungan dan menghindari kerugian. Fitur unggulan termasuk:
            <ul class="list-disc list-inside mt-4 space-y-2 text-gray-600">
                <li>Perhitungan ROAS instan.</li>
                <li>Analisis detail dengan rekomendasi aksi.</li>
                <li>Mendukung impor data CSV untuk analisis massal.</li>
                <li>Simulasi profit berdasarkan berbagai skenario.</li>
            </ul>
        </p>
    </div>
</div>

<script>
    // --- App Notification Countdown Logic (Copied from roas_calculator.html, adjusted for this template) ---
    const timeRemainingSeconds = {{ time_remaining_seconds | default(0) }};
    const appNotificationMessageElement = document.getElementById('app-notification-message');
    const notificationType = "{{ notification_type | default('') }}";
    const notificationMessagePrefix = "{{ notification_message_prefix | default('') }}";
    const appName = "{{ app.name | default('') }}"; // Mengambil nama aplikasi dari app object

    function formatTimeForAppNotification(totalSeconds) {
        if (totalSeconds <= 0) {
            return "00:00:00";
        }
        const days = Math.floor(totalSeconds / (3600 * 24));
        const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const remainingSeconds = Math.floor(totalSeconds % 60);

        let timeString = '';
        if (days > 0) {
            timeString += `${days} hari `;
        }
        timeString += `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        return timeString;
    }

    document.addEventListener('DOMContentLoaded', () => {
        if (!appNotificationMessageElement) {
            return; // Exit if the element doesn't exist (e.g., notification not rendered)
        }

        if (notificationType === 'expired') {
            appNotificationMessageElement.textContent = notificationMessagePrefix;
        } else if (notificationType === 'trial') {
            let seconds = timeRemainingSeconds;

            const countdownInterval = setInterval(() => {
                seconds--;
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    appNotificationMessageElement.textContent = `Masa percobaan untuk Aplikasi ${appName} telah berakhir! Silakan Hubungi Admin untuk memperpanjang.`;
                } else {
                    appNotificationMessageElement.textContent = `${notificationMessagePrefix} ${formatTimeForAppNotification(seconds)}, Silakan Hubungi Admin untuk memperpanjang!`;
                }
            }, 1000);

            // Set initial text immediately
            appNotificationMessageElement.textContent = `${notificationMessagePrefix} ${formatTimeForAppNotification(seconds)}, Silakan Hubungi Admin untuk memperpanjang!`;
        } else if (notificationType === 'premium') {
             let seconds = timeRemainingSeconds;

            const countdownInterval = setInterval(() => {
                seconds--;
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    appNotificationMessageElement.textContent = `Langganan Premium untuk Aplikasi ${appName} telah berakhir! Silakan Hubungi Admin untuk memperpanjang.`;
                } else {
                    appNotificationMessageElement.textContent = `${notificationMessagePrefix} ${formatTimeForAppNotification(seconds)}.`;
                }
            }, 1000);

            // Set initial text immediately
            appNotificationMessageElement.textContent = `${notificationMessagePrefix} ${formatTimeForAppNotification(seconds)}.`;
        }
    });
</script>

{% endblock %}