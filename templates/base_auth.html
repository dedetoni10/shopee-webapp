<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF="8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}rumaiku.id{% endblock %}</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Universal reset for margin and padding */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%; /* Ensure html and body take full height */
            width: 100%; /* Ensure html and body take full width */
        }
        body {
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden; /* Prevent horizontal scrollbar during transitions */
            display: flex; /* Make body a flex container */
            flex-direction: row; /* Sidebar and content area side-by-side for desktop */
            background-color: #f8fafc; /* Very light background for modern look */
        }

        /* --- Custom CSS to hide number input spinners --- */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield; /* Firefox */
            appearance: textfield; /* Standard property */
        }
        /* --- End Custom CSS --- */

        /* --- Dark Mode Styles (Enhanced) --- */
        html.dark {
            background-color: #1a202c; /* Deeper dark background */
            color: #cbd5e0; /* Default lighter text for dark mode */
        }
        html.dark .bg-gray-100 { background-color: #2d3748; } /* Darker background for main content area (if used) */
        html.dark .bg-white { background-color: #2d3748; color: #e2e8f0; } /* Darker white elements */
        html.dark .bg-gray-50 { background-color: #2d3748; color: #e2e8f0; } /* Darker gray-50 for forms */
        
        /* Text Color Adjustments for Dark Mode */
        html.dark .text-gray-800 { color: #f8fafc; } /* Almost white for darkest text */
        html.dark .text-gray-700 { color: #cbd5e0; } /* Lighter for darker text */
        html.dark .text-gray-600 { color: #e2e8f0; } /* Lighter for medium text */
        html.dark .text-gray-500 { color: #a0aec0; } /* For secondary text, lighter from default */
        html.dark .text-gray-400 { color: #718096; } /* For lightest text (still a bit dark for hints) */
        
        html.dark .bg-gray-700 { background-color: #4a5568; } /* Darker gray for active/hover states */
        html.dark .bg-gray-80-custom { background-color: #1a202c; } /* Custom class for specific dark element */
        html.dark .border-gray-700 { border-color: #4a5568; } /* Darker border for sidebar */
        html.dark .hover\:bg-gray-700:hover { background-color: #4a5568; }
        html.dark .hover\:text-white:hover { color: #fff; }
        html.dark .hover\:bg-gray-100:hover { background-color: #4a5568; } /* Adjusted hover for dark mode elements */
        html.dark .hover\:bg-gray-50:hover { background-color: #4a5568; }
        html.dark .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0,0,0,0.4); } /* Slightly softer shadows */
        html.dark .shadow-md { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.4), 0 2px 4px -1px rgba(0,0,0,0.4); }
        html.dark .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.4), 0 4px 6px -2px rgba(0,0,0,0.4); }
        html.dark .border-gray-200 { border-color: #4a5568; } /* Darker borders for light elements */

        /* General Dropdown Menu */
        .dropdown-menu {
            display: none;
            border-radius: 0.5rem; /* Standard rounded */
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* Standard shadow */
        }
        .dropdown-menu.active {
            display: block;
        }
        html.dark .dropdown-menu {
            background-color: #2d3748;
            border-color: #4a5568;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        html.dark .user-dropdown-link {
             color: #cbd5e0;
        }
        
        html.dark .user-dropdown-link:hover {
            background-color: #4a5568;
            color: #fff;
        }


        /* --- Sidebar Styling (Refined) --- */
        .sidebar {
            width: 250px;
            flex-shrink: 0; /* Prevents sidebar from shrinking */
            height: 100vh; /* Full viewport height */
            z-index: 50;
            box-shadow: 2px 0 8px rgba(0,0,0,0.05); /* Subtle shadow */
            padding-top: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: #1f2937; /* Darker blue-gray for sidebar */
            /* Transition applied by JS after initial render */
        }
        .sidebar.enable-transition {
            transition: width 0.3s ease-in-out, padding 0.3s ease-in-out;
        }

        .sidebar.collapsed {
            width: 64px;
        }
        
        .sidebar .menu-text {
            opacity: 1;
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            transition: opacity 0.3s ease, max-width 0.3s ease;
            font-size: 0.875rem; /* text-sm */
            line-height: 1;
        }
        .sidebar.collapsed .menu-text {
            opacity: 0;
            max-width: 0;
            margin-right: 0 !important;
        }
        
        .sidebar .collapsed-logo {
            display: none;
            font-size: 1.25rem; /* text-xl */
            font-weight: 700;
        }
        .sidebar.collapsed .collapsed-logo {
            display: block;
        }
        .sidebar:not(.collapsed) .rumaiku-logo {
            display: block;
            font-size: 1.5rem; /* text-2xl */
        }
        .sidebar.collapsed .rumaiku-logo {
            display: none;
        }

        /* Menu Item Link Styling (Common for both states) */
        .sidebar .menu-item a {
            display: flex;
            align-items: center;
            height: 36px; /* Slightly smaller height for a compact feel */
            padding: 0.5rem 0.75rem; /* Reduced padding */
            border-radius: 0.375rem; /* rounded-md */
            margin-bottom: 0.3rem; /* Reduced spacing */
            box-sizing: border-box;
            text-decoration: none;
            color: #cbd5e0; /* text-gray-400 */
            font-size: 0.875rem; /* text-sm */
            transition: background-color 0.2s ease, color 0.2s ease; /* Smooth transitions */
        }
        .sidebar .menu-item a.bg-gray-700 { /* Active item background */
            background-color: #3b82f6; /* blue-500 */
            color: #fff;
            font-weight: 600; /* semi-bold for active */
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .sidebar .menu-item a:hover {
            background-color: #4a5568; /* dark:hover:bg-gray-700 */
            color: #fff;
        }


        .sidebar .menu-item a svg {
            width: 18px; /* Slightly smaller icon size */
            height: 18px;
            flex-shrink: 0;
            margin-right: 0.6rem; /* Reduced margin */
        }
        .sidebar.collapsed .menu-item a svg {
            margin-right: 0;
        }

        /* Specific styles for menu items when collapsed */
        .sidebar.collapsed .menu-item a {
            justify-content: center;
            padding: 0.5rem;
            width: 36px;
            height: 36px;
            margin: 0.3rem auto;
        }

        /* Hide specific elements when sidebar is collapsed */
        .sidebar.collapsed #user-menu-button-desktop .user-menu-arrow {
            display: none;
        }

        /* Tooltip for collapsed sidebar */
        .menu-item-tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            left: calc(100% + 8px);
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            background-color: #4a5568;
            color: #fff;
            padding: 0.2rem 0.5rem;
            border-radius: 0.2rem;
            font-size: 0.75rem;
            z-index: 60;
            pointer-events: none;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }

        /* Show tooltip only when sidebar is collapsed and item is hovered */
        .sidebar.collapsed .menu-item:hover .menu-item-tooltip {
            visibility: visible;
            opacity: 1;
        }
        .sidebar:not(.collapsed) .menu-item-tooltip {
            display: none;
        }

        /* Sidebar user info and toggle button adjustments */
        .sidebar .user-info-section {
            padding-bottom: 0.5rem;
        }
        .sidebar:not(.collapsed) .user-info-section {
            padding-bottom: 1rem;
        }
        
        /* Content area that sits next to the sidebar */
        .content-area {
            flex-grow: 1; /* Allows it to take up remaining horizontal space */
            display: flex; /* Make it a flex container for its children (header and main) */
            flex-direction: column; /* Stack header and main vertically */
            height: 100vh; /* Takes full vertical height of its parent (body) */
            overflow-y: hidden; /* Hide main content area's own scroll, let main handle its own scroll */
            /* Removed margin-left properties, relying on JS for initial positioning */
            /* Transition added by JS */
        }
        .content-area.enable-transition {
            transition: margin-left 0.3s ease-in-out;
        }

        /* Initial content area margin, set by JS on page load */
        /* These classes will be applied by JS before DOMContentLoaded */
        .initial-expanded .content-area {
            margin-left: 250px;
        }
        .initial-collapsed .content-area {
            margin-left: 64px;
        }

        /* Mobile specific adjustments */
        @media (max-width: 767px) {
            body {
                flex-direction: column; /* Stack sidebar and content vertically on mobile */
            }
            .sidebar {
                display: none; /* Hide sidebar completely on mobile by default */
            }
            .content-area {
                margin-left: 0 !important; /* No margin on mobile */
                width: 100%; /* Full width on mobile */
                height: calc(100vh - 56px); /* Adjusted for bottom nav */
                padding-bottom: 56px; /* Space for bottom nav */
            }
        }


        /* Mobile Bottom Navigation (Refined) */
        #bottom-nav {
            box-shadow: 0 -3px 12px rgba(0, 0, 0, 0.15);
            background-color: #1f2937;
            height: 56px;
            z-index: 50;
            border-top: 1px solid rgba(255,255,255,0.1);
            position: fixed; /* Keep it fixed at the bottom */
            bottom: 0;
            left: 0;
            right: 0;
        }
        #bottom-nav a {
            flex-grow: 1;
            padding: 0.4rem 0;
            font-size: 0.75rem;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        #bottom-nav a.text-white {
            color: #3b82f6; /* Blue-500 for active tab */
            font-weight: 600;
        }
        #bottom-nav svg {
            width: 22px;
            height: 22px;
        }
        html.dark #bottom-nav {
            background-color: #1a202c;
            box-shadow: 0 -3px 12px rgba(0, 0, 0, 0.4);
            border-top: 1px solid rgba(0,0,0,0.3);
        }
        html.dark #bottom-nav a.text-white {
            color: #60a5fa; /* A bit lighter blue for dark mode active */
        }
        html.dark #bottom-nav a.text-gray-400 {
            color: #a0aec0; /* Lighter gray for inactive */
        }

        /* Custom Font Size (text-xxs, for countdown on cards) */
        .text-xxs {
            font-size: 0.625rem; /* 10px */
            line-height: 1;
        }

        /* Input field focus glow (subtle) */
        input[type="number"]:focus, input[type="text"]:focus, input[type="file"]:focus {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); /* blue-500 with 30% opacity */
            border-color: #3b82f6; /* blue-500 */
        }
        html.dark input[type="number"]:focus, html.dark input[type="text"]:focus, html.dark input[type="file"]:focus {
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.4); /* blue-400 with 40% opacity for dark mode */
            border-color: #60a5fa; /* blue-400 */
        }

        /* Table styles for compact and clean look */
        .table-container table {
            width: 100%; /* Ensure table takes full width of its container */
            border-collapse: collapse; /* Remove space between borders */
        }
        .table-container table thead th {
            padding: 6px 4px; /* Reduced padding for tighter layout */
            vertical-align: middle; /* Center text vertically in two-line headers */
            line-height: 1.2; /* Adjust line height for two-line headers */
            border-right: 1px solid #e2e8f0; /* Add vertical dividers */
            border-bottom: 1px solid #e2e8f0; /* Add bottom border to header */
            text-align: left; /* Ensure text alignment is left by default */
        }
        html.dark .table-container table thead th {
            border-color: #4a5568;
            color: #cbd5e0;
        }
        .table-container table thead th:last-child {
            border-right: none; /* Remove divider on the last column */
        }
        .table-container table tbody tr {
            transition: background-color 0.1s ease; /* Smooth transition for hover */
        }
        .table-container table tbody tr:nth-child(even) { /* Striped rows for better readability */
            background-color: #fcfcfc; /* Very light subtle stripe */
        }
        .table-container table tbody tr:hover {
            background-color: #e0f2fe; /* Light blue background on hover (blue-50) */
        }
        html.dark .table-container table tbody tr:nth-child(even) {
            background-color: #2a333d; /* Darker stripe for dark mode */
        }
        html.dark .table-container table tbody tr:hover {
            background-color: #3d4a5c; /* Darker blue hover for dark mode */
        }
        .table-container table tbody td {
            padding: 6px 4px; /* Reduced padding for tighter layout */
            border-right: 1px solid #e2e8f0; /* Add vertical dividers for cells too */
            border-bottom: 1px solid #e2e8f0; /* Bottom border for cells */
        }
        html.dark .table-container table tbody td {
            border-color: #4a5568;
            color: #e2e8f0;
        }
        .table-container table tbody td:last-child {
            border-right: none; /* Remove divider on the last cell of row */
        }
        .table-container table tbody tr:last-child td {
            border-bottom: none; /* Remove bottom border from last row cells */
        }
    </style>

    <script>
        // SCRIPT INI DIJALANKAN SANGAT AWAL (DI HEAD) UNTUK MENCEGAH FOUC/FLASH SIDEBAR
        (function() {
            const htmlElement = document.documentElement;
            const contentArea = document.querySelector('.content-area');
            const sidebar = document.getElementById('sidebar');

            // Inisialisasi Dark Mode
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'dark') {
                htmlElement.classList.add('dark');
            } else if (storedTheme === 'light') {
                htmlElement.classList.remove('dark');
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                htmlElement.classList.add('dark');
            }

            // Inisialisasi Status Sidebar (untuk mencegah flash saat load)
            const sidebarCollapsedState = localStorage.getItem('sidebarCollapsed');
            
            if (sidebarCollapsedState === 'true') {
                htmlElement.classList.add('initial-render-collapsed');
                if (sidebar) sidebar.classList.add('collapsed');
                if (contentArea) contentArea.style.marginLeft = '64px'; /* Set initial margin */
            } else {
                htmlElement.classList.add('initial-render-expanded');
                if (sidebar) sidebar.classList.remove('collapsed');
                if (contentArea) contentArea.style.marginLeft = '250px'; /* Set initial margin */
            }
            
            // Add transition classes AFTER a tiny delay to prevent FOUC
            window.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    const sidebarElement = document.getElementById('sidebar');
                    if (sidebarElement) {
                        sidebarElement.classList.add('enable-transition');
                    }
                    const contentAreaElement = document.querySelector('.content-area');
                    if (contentAreaElement) {
                        contentAreaElement.classList.add('enable-transition');
                    }
                    htmlElement.classList.remove('initial-render-collapsed', 'initial-render-expanded');
                }, 0);
            });
        })();
    </script>
</head>
<body class="bg-gray-100 antialiased h-screen overflow-y-hidden">
    <aside id="sidebar" class="sidebar bg-gray-800 text-white p-4 hidden md:flex z-40">
        <nav class="flex-1">
            <div class="py-3 px-2 mb-4 text-center">
                <h1 class="font-bold text-white">
                    <span class="rumaiku-logo text-2xl">rumaiku.id</span>
                    <span class="collapsed-logo text-xl">RM</span> {# Short logo for collapsed state #}
                </h1>
            </div>
            <ul>
                <li class="menu-item relative">
                    <a href="{{ url_for('dashboard.index') }}" class="flex items-center h-9 p-2 rounded-md text-gray-400 hover:bg-gray-700 hover:text-white {% if request.endpoint == 'dashboard.index' %} bg-gray-700 text-white {% endif %}">
                        <svg class="w-5 h-5 flex-none" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                        <span class="menu-text">Dashboard</span>
                    </a>
                    <span class="menu-item-tooltip">Dashboard</span>
                </li>
                <li class="menu-item relative">
                    <a href="{{ url_for('app_store.index') }}" class="{% if request.endpoint == 'app_store.index' %} bg-gray-700 text-white {% else %} text-gray-400 hover:bg-gray-700 hover:text-white {% endif %}">
                        <svg class="w-5 h-5 flex-none" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                        <span class="menu-text">App Store</span>
                    </a>
                    <span class="menu-item-tooltip">App Store</span>
                </li>
                
                {# BAGIAN INI UNTUK MENAMPILKAN APLIKASI TERINSTAL LANGSUNG DI SIDEBAR #}
                {% if installed_apps_for_sidebar and installed_apps_for_sidebar|length > 0 %}
                <li class="my-2 border-t border-gray-700"></li> {# Garis pemisah lebih kecil #}
                {% for app in installed_apps_for_sidebar %}
                <li class="menu-item relative installed-app-menu-item">
                    {# Use app.url_endpoint to dynamically generate the URL #}
                    <a href="{{ url_for(app.url_endpoint) }}" class="flex items-center h-9 p-2 rounded-md text-gray-400 hover:bg-gray-700 hover:text-white {% if request.endpoint == app.url_endpoint %} bg-gray-700 text-white {% endif %}">
                        {% if app.url == 'roas_calculator' %}
                        <svg class="w-4 h-4 flex-none" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v4m0-4H9m0 0V9m6 0a6 6 0 01-6 6H9a6 6 0 01-6-6V9a6 6 0 016-6h6a6 6 0 016 6v4a6 6 0 01-6 6h-3"></path></svg>
                        {% else %}
                        {# Default icon if not ROAS calculator #}
                        <svg class="w-4 h-4 flex-none" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                        {% endif %}
                        <span class="menu-text">{{ app.name }}</span>
                    </a>
                    <span class="menu-item-tooltip">{{ app.name }}</span>
                </li>
                {% endfor %}
                {% endif %}
                {# AKHIR BAGIAN APLIKASI TERINSTAL LANGSUNG DI SIDEBAR #}
            </ul>
        </nav>

        {# User Profile & Logout Section (at the bottom of sidebar) #}
        <div class="relative py-3 border-t border-gray-700 user-info-section">
            <button id="user-menu-button-desktop" class="flex items-center w-full h-9 p-2 rounded-lg text-gray-400 hover:text-white font-semibold focus:outline-none justify-between">
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2 flex-none" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                    <span class="menu-text text-sm">{{ current_user.username }}</span>
                </div>
                <svg class="w-3 h-3 ml-auto transition-transform duration-300 user-menu-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            <span class="menu-item-tooltip">Profil Pengguna</span>

            <div id="user-menu-desktop" class="dropdown-menu absolute bottom-full left-0 w-48 bg-white rounded-md shadow-lg py-1 ring-1 ring-black ring-opacity-5 focus:outline-none z-20" role="menu">
                <a href="{{ url_for('auth.profile') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 user-dropdown-link" role="menuitem">Edit Profil</a>
                <a href="{{ url_for('auth.logout') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 user-dropdown-link" role="menuitem">Logout</a>
            </div>
        </div>
    </aside>

    <div class="content-area"> {# This flex container will grow to fill remaining space #}
        <header class="bg-white shadow-sm p-3 sticky top-0 z-10 flex items-center flex-shrink-0">
            <button id="toggle-sidebar-button" class="text-gray-600 hover:text-blue-500 mr-3 hidden md:block p-1 rounded-md hover:bg-gray-100 transition-colors">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            {# Logo / Site Title for mobile/tablet header #}
            <a href="{{ url_for('homepage.index') }}" class="text-xl font-bold text-gray-800 md:hidden">rumaiku.id</a>
            
            {# Ini adalah tempat block header_title didefinisikan #}
            <h2 class="text-xl font-bold text-gray-800 ml-3 hidden md:block">{% block header_title %}{% endblock %}</h2>
            
            <div class="relative flex items-center space-x-2 ml-auto">
                <button id="notification-button" class="text-gray-600 hover:text-blue-500 p-1 rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                </button>
                <div id="notification-dropdown" class="absolute right-0 mt-2 top-full w-64 bg-white rounded-md shadow-lg py-1 ring-1 ring-black ring-opacity-5 focus:outline-none z-20 hidden">
                    <div class="px-4 py-2 text-sm text-gray-700">Tidak ada notifikasi baru.</div>
                </div>

                <button id="dark-mode-toggle" class="text-gray-600 hover:text-blue-500 p-1 rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="dark-mode-icon"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
            </div>
        </header>
        
        {# --- BLOCK BARU UNTUK NOTIFIKASI KHUSUS APLIKASI --- #}
        {% block app_notification %}{% endblock %}
        {# --- AKHIR BLOCK NOTIFIKASI KHUSUS APLIKASI --- #}

        <main class="p-4 flex-1 overflow-y-auto">
            {# Flash Messages #}
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="mb-3 space-y-1 text-sm">
                        {% for category, message in messages %}
                            <div class="p-2 rounded-md text-xs
                                {% if category == 'success' %} bg-green-100 text-green-800
                                {% elif category == 'error' or category == 'danger' %} bg-red-100 text-red-800
                                {% elif category == 'info' %} bg-blue-100 text-blue-800
                                {% elif category == 'warning' %} bg-yellow-100 text-yellow-800
                                {% else %} bg-gray-100 text-gray-800
                                {% endif %}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </main>
    </div>

    {# Mobile Bottom Navigation #}
    <footer id="bottom-nav" class="text-white fixed bottom-0 left-0 w-full md:hidden">
        <div class="flex justify-around items-center h-14">
            <a href="{{ url_for('dashboard.index') }}" class="flex flex-col items-center py-1
                {% if request.endpoint == 'dashboard.index' %} text-white {% else %} text-gray-400 hover:text-white {% endif %}">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                <span class="text-xs mt-1">Dasbor</span>
            </a>
            <a href="{{ url_for('app_store.index') }}" class="flex flex-col items-center py-1
                {% if request.endpoint == 'app_store.index' %} text-white {% else %} text-gray-400 hover:text-white {% endif %}">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                <span class="text-xs mt-1">App Store</span>
            </a>
            <a href="{{ url_for('auth.profile') }}" class="flex flex-col items-center py-1
                {% if request.endpoint == 'auth.profile' %} text-white {% else %} text-gray-400 hover:text-white {% endif %}">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                <span class="text-xs mt-1">Akun</span>
            </a>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Dropdown User Profile di Sidebar (Desktop) ---
            const userMenuButton = document.getElementById('user-menu-button-desktop');
            const userMenuDropdown = document.getElementById('user-menu-desktop');

            if (userMenuButton && userMenuDropdown) {
                userMenuButton.addEventListener('click', () => {
                    userMenuDropdown.classList.toggle('active');
                    // Tambahkan rotasi panah jika diperlukan
                    userMenuButton.querySelector('.user-menu-arrow').classList.toggle('rotate-180');
                });

                // Tutup dropdown saat klik di luar
                document.addEventListener('click', (event) => {
                    if (!userMenuButton.contains(event.target) && !userMenuDropdown.contains(event.target)) {
                        userMenuDropdown.classList.remove('active');
                        userMenuButton.querySelector('.user-menu-arrow').classList.remove('rotate-180');
                    }
                });
            }

            // --- Toggle Dark Mode ---
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const htmlElement = document.documentElement; // Akses elemen <html>

            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', () => {
                    if (htmlElement.classList.contains('dark')) {
                        htmlElement.classList.remove('dark');
                        localStorage.setItem('theme', 'light');
                    } else {
                        htmlElement.classList.add('dark');
                        localStorage.setItem('theme', 'dark');
                    }
                });
            }

            // --- Notification Dropdown ---
            const notificationButton = document.getElementById('notification-button');
            const notificationDropdown = document.getElementById('notification-dropdown');

            if (notificationButton && notificationDropdown) {
                notificationButton.addEventListener('click', (event) => {
                    event.stopPropagation(); // Mencegah event mencapai document click listener
                    notificationDropdown.classList.toggle('hidden');
                });

                // Tutup dropdown notifikasi saat klik di luar
                document.addEventListener('click', (event) => {
                    if (!notificationButton.contains(event.target) && !notificationDropdown.contains(event.target)) {
                        notificationDropdown.classList.add('hidden');
                    }
                });
            }

            // --- Sidebar Toggle Functionality (Tambahan, jika belum ada atau perlu penyempurnaan) ---
            const toggleSidebarButton = document.getElementById('toggle-sidebar-button');
            const sidebar = document.getElementById('sidebar');
            const contentArea = document.querySelector('.content-area');

            if (toggleSidebarButton && sidebar && contentArea) {
                toggleSidebarButton.addEventListener('click', () => {
                    const isCollapsed = sidebar.classList.toggle('collapsed');
                    localStorage.setItem('sidebarCollapsed', isCollapsed); // Simpan status di localStorage

                    // Sesuaikan margin-left content-area berdasarkan status sidebar
                    if (isCollapsed) {
                        contentArea.style.marginLeft = '64px';
                    } else {
                        contentArea.style.marginLeft = '250px';
                    }
                });
            }
        });
    </script>
</body>
</html>